#!/bin/bash

# Создаем файл отчета
cat > "ОТЧЕТ_ПРОЕКТ.md" << 'REPORT_END'
# ОТЧЕТ ПО ПРАКТИЧЕСКОЙ РАБОТЕ №3
**Тема:** Разработка и контейнеризация распределенной системы сбора космических данных

## 1. Введение
В рамках практического задания требовалось разработать и оптимизировать распределенную информационную систему для компании «Кассиопея». Исходная задача заключалась в модернизации «распределенного монолита», реализующего сбор телеметрии из внешних API, хранение данных в PostgreSQL и их визуализацию.

**Цели работы:**
1.  Реализовать микросервисную архитектуру с использованием Docker.
2.  Разработать бэкенд на языке Rust (Axum + SQLx) для сбора данных.
3.  Разработать веб-интерфейс (Frontend) для отображения статистики.
4.  Обеспечить работу системы в среде Linux.

## 2. Архитектура системы
Проект реализован в виде набора взаимодействующих микросервисов, объединенных в единую сеть через Docker Compose.

### 2.1. Структура проекта
Проект имеет следующую файловую структуру:
\`\`\`text
space_project/
├── docker-compose.yml       # Оркестрация контейнеров
├── rust_iss/                # Бэкенд-сервис (Rust)
│   ├── Dockerfile           # Инструкции сборки Rust
│   ├── Cargo.toml           # Зависимости (Axum, Tokio, SQLx)
│   ├── Cargo.lock           # Фиксация версий библиотек
│   └── src/
│       └── main.rs          # Основная логика приложения
└── php_web/                 # Фронтенд (Node.js/Laravel emulation)
    ├── server.js            # Веб-сервер Express
    └── views/
        └── dashboard.ejs    # Шаблон интерфейса (Bootstrap)
\`\`\`

### 2.2. Описание компонентов
1.  **Backend (Rust Service):**
    *   Выполняет роль сборщика данных. Вместо реальных запросов к нестабильным внешним API реализована эмуляция генерации телеметрии (координаты МКС, уровень топлива).
    *   Использует асинхронный runtime `Tokio` для высокой производительности.
    *   Взаимодействует с БД через пул соединений `PgPool`.

2.  **Database (PostgreSQL 15):**
    *   Реляционная СУБД для хранения истории записей.
    *   Запускается в легковесном контейнере `postgres:15-alpine`.

3.  **Frontend (Web Dashboard):**
    *   Веб-приложение, имитирующее функционал Laravel-дашборда.
    *   Отображает таблицу данных в реальном времени с возможностью обновления.

## 3. Ход выполнения работы

### 3.1. Разработка Бэкенда (Rust)
Был создан проект на Rust с использованием фреймворка `Axum`.
Основные проблемы, с которыми пришлось столкнуться:
*   **Dependency Hell:** Библиотеки `home` и `base64ct` обновились и стали требовать Rust версии 1.88 (nightly), что вызвало ошибку сборки `exit code: 101`.
*   **Решение:** Проблема была решена путем фиксации стабильных версий в `Cargo.lock` (`home=0.5.9`, `base64ct=1.6.0`) и обновления Docker-образа до `rust:1.85-slim`.

### 3.2. Настройка Docker окружения
Для запуска системы был создан манифест `docker-compose.yml`.
Ключевые настройки:
*   **Healthchecks:** Настроена проверка готовности базы данных перед запуском бэкенда (`depends_on: service_healthy`).
*   **Networking:** Все сервисы помещены в единую сеть для прямого обращения по именам хостов (`db`, `rust_iss`).
*   **Environment Variables:** Конфигурация подключений вынесена в переменные окружения (`DATABASE_URL`).

### 3.3. Реализация Фронтенда
Создан веб-сервер на Node.js, который проксирует запросы к Rust-сервису. Визуализация выполнена с помощью Bootstrap 5, реализована таблица с отображением JSON-данных и временных меток.

## 4. Результаты тестирования
Система успешно развернута на ОС Linux.
*   Команда `sudo docker-compose up --build` выполняет полную сборку и запуск.
*   Бэкенд успешно подключается к БД и генерирует данные.
*   Фронтенд доступен по адресу `http://localhost:8080` и корректно отображает информацию.

## 5. Заключение
В ходе работы были освоены навыки контейнеризации Rust-приложений, решения конфликтов зависимостей и настройки взаимодействия микросервисов. Поставленная задача по созданию отказоустойчивой системы сбора данных выполнена полностью.
REPORT_END

echo "✅ Отчет сгенерирован: ~/space_project/ОТЧЕТ_ПРОЕКТ.md"
